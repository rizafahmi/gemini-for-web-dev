<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aplikasi buat kaum mendang-mending</title>
  <meta name="description"
    content="Jika kamu galau dalam menentukan pilihan, aplikasi ini bisa menjadi jawaban. Ditenagai oleh Google Gemini API.">
  <!-- Facebook Meta Tags -->
  <meta property="og:url" content="https://gemini-mendang-mending-mjgx6qvgeq-et.a.run.app/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Aplikasi buat kaum mendang-mending">
  <meta property="og:description"
    content="Jika kamu galau dalam menentukan pilihan, aplikasi ini bisa menjadi jawaban. Ditenagai oleh Google Gemini API.">
  <meta property="og:image" content="https://riza-screenshots.s3.amazonaws.com/og-fb.png">

  <!-- Twitter Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta property="twitter:domain" content="gemini-mendang-mending-mjgx6qvgeq-et.a.run.app">
  <meta property="twitter:url" content="https://gemini-mendang-mending-mjgx6qvgeq-et.a.run.app/">
  <meta name="twitter:title" content="Aplikasi buat kaum mendang-mending">
  <meta name="twitter:description"
    content="Jika kamu galau dalam menentukan pilihan, aplikasi ini bisa menjadi jawaban. Ditenagai oleh Google Gemini API.">
  <meta name="twitter:image" content="https://riza-screenshots.s3.amazonaws.com/og-twitter.png">

  <!-- Meta Tags Generated via https://www.opengraph.xyz -->

  <style>
    @import url('https://fonts.upset.dev/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap');
  </style>
  <style>
    html {
      background-color: #232946;
      font-family: Montserrat, proxima-nova, sans-serif;
    }

    body {
      font-size: 18px;
      line-height: 1.8;
      font-weight: 400;
      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    h2 {
      color: #fffffe;
    }

    h3 {
      text-transform: uppercase;
    }

    section {
      background-color: #eebbc3;
      color: #232946;
      font-size: 1.5rem;
      font-weight: 600;
      padding: 2rem 1rem;
      text-align: center;
    }

    input[type="text"] {
      font-family: Montserrat, proxima-nova, sans-serif;
      font-size: 1.5rem;
      background-color: transparent;
      border-color: #fffffe;
      color: #232946;
      height: 2.5rem;
      margin-bottom: 0px;
      padding-left: 20px;
      border: 0;
      border-bottom: 3px dashed #232323;
      border-radius: 3px;
      font-weight: 500;
      font-size: 16px;
      line-height: 1.4;
      vertical-align: middle;


    }

    input[type="text"]:focus {
      outline: 0;
    }

    #topic {
      width: 36rem;
    }

    #compareButton {
      font-size: 1.25rem;
      background-color: #232946;
      color: #fffffe;
      width: 80%;
      padding: 0.7rem;
      margin: 1rem;
      border: 0;
      cursor: pointer;
      border-radius: 3px;
    }

    #compareButton:disabled {
      background-color: #b8c1ec;
    }

    button.votes,
    button.share {
      padding: 0.25rem 0.5rem;
      background: #fffffe;
      border: 0;
      border-radius: 3px;
      margin-right: 0.25rem;
    }

    .topic {
      padding-bottom: 0.5rem;
    }

    .options {
      padding-bottom: 0.5rem;
    }

    main {
      margin: 6rem 3rem;
      padding: 2.5rem;
      border-radius: 3px;
      background-color: #fffffe;
      opacity: 1;
      transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg);
      transform-style: preserve-3d;
    }

    div.result {
      margin: 6rem 3rem;
      padding: 2.5rem;
      border-radius: 3px;
      background-color: #b8c1ec;
      opacity: 1;
      transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg);
      transform-style: preserve-3d;
    }

    .resultContainer {
      width: 90%;
      max-width: 1040px;
      margin-left: auto;
      margin-right: auto;
    }

    footer {
      padding: 3.5rem;
      background-color: #fffffe;
      text-align: center;
      color: #232946;
    }

    @media screen and (max-width: 800px) {

      main,
      div.result {
        margin: 3rem 1rem;
        padding: 1.5rem;
      }

      #topic {
        width: 100%;
      }

      .options {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .options span {
        margin-bottom: 0.5rem;
      }

      .options input[type="text"] {
        width: 100%;
        margin-bottom: 0.5rem;
      }

      #compareButton {
        width: 80%;
        font-size: 1rem;
      }

      #compareButton span {
        font-size: 1rem;
      }

      #forkongithub {
        display: none;
        /* Hide the GitHub ribbon on mobile */
      }
    }

    #forkongithub a {
      background: #232946;
      color: #fffffe;
      text-decoration: none;
      font-family: arial, sans-serif;
      text-align: center;
      font-weight: bold;
      padding: 5px 40px;
      font-size: 1rem;
      line-height: 2rem;
      position: relative;
      transition: 0.5s;
    }

    #forkongithub a:hover {
      background: #d4939d;
      color: #fffffe;
    }

    #forkongithub a::before,
    #forkongithub a::after {
      content: "";
      width: 100%;
      display: block;
      position: absolute;
      top: 1px;
      left: 0;
      height: 1px;
      background: #fffffe;
    }

    #forkongithub a::after {
      bottom: 1px;
      top: auto;
    }

    @media screen and (min-width:800px) {
      #forkongithub {
        position: fixed;
        display: block;
        top: 0;
        right: 0;
        width: 200px;
        overflow: hidden;
        height: 200px;
        z-index: 9999;
      }

      #forkongithub a {
        width: 200px;
        position: absolute;
        top: 60px;
        right: -60px;
        transform: rotate(45deg);
        -webkit-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        -moz-transform: rotate(45deg);
        -o-transform: rotate(45deg);
        box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.8);
      }
    }
  </style>
</head>

<body>
  <span id="forkongithub"><a href="https://github.com/rizafahmi/gemini-for-web-dev" target="_blank">Fork me on
      GitHub</a></span>
  <section>
    <div class="topic"><input type="text" id="topic" name="topic" placeholder="Topik untuk dibandingkan..." required />
    </div>

    <div class="options">
      <span>mending</span> <input type="text" name="option1" id="option1" placeholder="opsi 1" required />
      atau <input type="text" name="option2" id="option2" placeholder="opsi 2" required />
    </div>

    <div class="action">
      <button id="compareButton"> üëá mending mana? </button>
    </div>

  </section>

  <main id="suggestion">
    <h3 id="topicText">Topic</h3>
    <div id="responseText"></div>
  </main>

  <div class="resultContainer">
    <h2>Hasil Terdahulu</h2>
    <template id="resultsTemplate">
      <div id="results">
      </div>
    </template>
  </div>

  <footer>Made with Google Cloud credits #GeminiSprint</footer>

  <script>
    document.addEventListener('DOMContentLoaded', async function () {
      console.log("Client side");
      suggestion.hidden = true;
      topic.focus();
      compareButton.disabled = true;

      const res = await fetch("/results");
      const results = await res.json()
      renderResults(results);

      option2.addEventListener('keydown', async function (e) {
        compareButton.disabled = false;
        if (e.key === 'Enter') {
          await runComparison();
        }
      });

      compareButton.addEventListener('click', async function (e) {
        await runComparison();
      });

    });


    async function compare(topic, opt1, opt2) {
      option2.blur();
      const url = `/compare?topic=${encodeURIComponent(topic)}&opt1=${encodeURIComponent(opt1)}&opt2=${encodeURIComponent(opt2)}`;

      try {
        const response = await fetch(url);

        if (response.status !== 200) {
          throw new Error('Unable to get an answer!');
        }
        const result = await response.text();
        console.log(result);
        if (result) {
          topicText.textContent = `${topic}: ${opt1} atau ${opt2}?`;
          responseText.insertAdjacentHTML('beforeend', result);
          suggestion.hidden = false;
          resetForm();
        }

      } catch (err) {
        console.error(err);
      }

    }
    function resetForm() {
      topic.value = '';
      option1.value = '';
      option2.value = '';

      topic.focus();
    }
    async function runComparison() {
      compareButton.textContent = "ü§î mikir dulu..."
      compareButton.disabled = true;
      await compare(topic.value.trim(), option1.value.trim(), option2.value.trim());
      compareButton.textContent = "üëá mending mana?"
      topic.focus();
      compareButton.disabled = true;
    }

    function renderResults(data) {
      document.querySelector('.resultContainer').appendChild(resultsTemplate.content);

      for (let d of data) {

        const resultDiv = document.createElement('div');
        resultDiv.id = `result_${d.id}`;
        resultDiv.className = 'result';

        const { option1, option2, result, topic } = d;
        const header = document.createElement('h3');
        header.textContent = `${topic}: ${option1} atau ${option2}?`;
        resultDiv.append(header);

        const votesDiv = document.createElement('div');
        const upvoteButton = document.createElement('button');
        upvoteButton.className = "votes";
        upvoteButton.textContent = `üëç ${d.upvote}`;
        upvoteButton.dataset.tid = d.id;
        const downvoteButton = document.createElement('button');
        downvoteButton.textContent = `üëé ${d.downvote}`;
        downvoteButton.dataset.tid = d.id;
        downvoteButton.className = "votes";
        const shareButton = document.createElement('button');
        shareButton.textContent = `üîó bagikan`;
        shareButton.className = "share";
        shareButton.dataset.tid = d.id;

        upvoteButton.addEventListener('click', async function (e) {
          e.target.disabled = true;
          fetch('/upvote', {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ id: e.target.dataset.tid })
          });
          upvoteButton.textContent = `üëç ${parseInt(upvoteButton.textContent.split(' ')[1]) + 1}`;
        });
        downvoteButton.addEventListener('click', async function (e) {
          e.target.disabled = true;
          fetch('/downvote', {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ id: e.target.dataset.tid })
          });
          downvoteButton.textContent = `üëé ${parseInt(downvoteButton.textContent.split(' ')[1]) - 1}`;
        });
        shareButton.addEventListener('click', async function (e) {
          const url = `https://gemini-mendang-mending-mjgx6qvgeq-et.a.run.app/#result_${e.target.dataset.tid}`;
          const text = `Saya baru saja membandingkan ${topic}: ${option1} atau ${option2}`;
          const title = `Mending mana? Aplikasi buat kamu kaum mendang-mending`;
          const twitter_url = `https://twitter.com/intent/tweet?text=${encodeURI(text)}&url=gemini-mendang-mending-mjgx6qvgeq-et.a.run.app/#result_${e.target.dataset.tid}`
          console.log(twitter_url);
          window.open(twitter_url);
        });

        votesDiv.append(upvoteButton);
        votesDiv.append(downvoteButton);
        votesDiv.append(shareButton);


        const responseDiv = document.createElement('div');
        responseDiv.insertAdjacentHTML('beforeend', result);
        resultDiv.append(responseDiv);
        resultDiv.append(votesDiv);

        results.append(resultDiv);
      }
    }
  </script>
</body>

</html>